{"ast":null,"code":"'use strict';\n\nconst ErrorReportingMixinBase = require('./mixin-base');\n\nconst ErrorReportingTokenizerMixin = require('./tokenizer-mixin');\n\nconst LocationInfoTokenizerMixin = require('../location-info/tokenizer-mixin');\n\nconst Mixin = require('../../utils/mixin');\n\nclass ErrorReportingParserMixin extends ErrorReportingMixinBase {\n  constructor(parser, opts) {\n    super(parser, opts);\n    this.opts = opts;\n    this.ctLoc = null;\n    this.locBeforeToken = false;\n  }\n\n  _setErrorLocation(err) {\n    if (this.ctLoc) {\n      err.startLine = this.ctLoc.startLine;\n      err.startCol = this.ctLoc.startCol;\n      err.startOffset = this.ctLoc.startOffset;\n      err.endLine = this.locBeforeToken ? this.ctLoc.startLine : this.ctLoc.endLine;\n      err.endCol = this.locBeforeToken ? this.ctLoc.startCol : this.ctLoc.endCol;\n      err.endOffset = this.locBeforeToken ? this.ctLoc.startOffset : this.ctLoc.endOffset;\n    }\n  }\n\n  _getOverriddenMethods(mxn, orig) {\n    return {\n      _bootstrap(document, fragmentContext) {\n        orig._bootstrap.call(this, document, fragmentContext);\n\n        Mixin.install(this.tokenizer, ErrorReportingTokenizerMixin, mxn.opts);\n        Mixin.install(this.tokenizer, LocationInfoTokenizerMixin);\n      },\n\n      _processInputToken(token) {\n        mxn.ctLoc = token.location;\n\n        orig._processInputToken.call(this, token);\n      },\n\n      _err(code, options) {\n        mxn.locBeforeToken = options && options.beforeToken;\n\n        mxn._reportError(code);\n      }\n\n    };\n  }\n\n}\n\nmodule.exports = ErrorReportingParserMixin;","map":null,"metadata":{},"sourceType":"script"}