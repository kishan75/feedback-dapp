{"ast":null,"code":"import _defineProperty from \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp-full\\\\feedback-dapp\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp-full\\\\feedback-dapp\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp-full\\\\feedback-dapp\\\\client\\\\src\\\\components\\\\Modals\\\\ProfessorDetails\\\\professorDetails.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState } from \"react\";\nimport axios from \"axios\";\nimport ProfessorDetailsFunctionBox from \"../../FunctionBox/ProfessorDetailsFunctionBox/professorDetailsFunctionBox\";\nimport \"./professorDetails.css\";\nimport { PYTHON_BASE_URL } from \"../../../constants\";\n\nconst ProfessorDetails = props => {\n  const uploadEndpoint = \"\".concat(PYTHON_BASE_URL, \"upload\");\n\n  const _useState = useState({\n    address: props.account,\n    ticket: \"\",\n    name: \"Dr. \",\n    email: \"\",\n    file: \"\"\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        professorDetails = _useState2[0],\n        setProfessorDetails = _useState2[1];\n\n  const _useState3 = useState({\n    address: \"\",\n    ticket: \"\",\n    name: \"\",\n    email: \"\",\n    file: \"\"\n  }),\n        _useState4 = _slicedToArray(_useState3, 2),\n        professorErrors = _useState4[0],\n        setProfessorErrors = _useState4[1];\n\n  const _useState5 = useState({\n    message: \"\",\n    disabled: false\n  }),\n        _useState6 = _slicedToArray(_useState5, 2),\n        disableUpload = _useState6[0],\n        setDisableUpload = _useState6[1]; // Asyncs:\n\n\n  const writeToBlockChain = async () => {\n    const feedbackData = props.contracts.feedbackData;\n\n    if (feedbackData != undefined) {\n      let result = await feedbackData.methods.createProfessor(professorDetails.name, professorDetails.email, \"\", professorDetails.ticket).send({\n        from: professorDetails.address\n      });\n      console.log(result);\n      return result;\n    } else {\n      props.onToastChange(\"INTERNAL-ERROR: Contract not deployed\", \"error\", true);\n      console.log(\"Feedback contract not deployed\");\n    }\n  }; // Handlers\n\n\n  const handleProfessorInputChange = event => {\n    setProfessorDetails(_objectSpread({}, professorDetails, {\n      [event.target.name]: event.target.value\n    }));\n\n    let updatedErrors = _objectSpread({}, professorErrors);\n\n    updatedErrors = validateProfessorInput(event.target.name, event.target.value, updatedErrors);\n    setProfessorErrors(_objectSpread({}, updatedErrors));\n  };\n\n  const handlerProfessorSubmit = () => {\n    props.onLoading(true);\n\n    let updatedErrors = _objectSpread({}, professorErrors);\n\n    for (var key in professorDetails) if (professorDetails.hasOwnProperty(key)) updatedErrors = validateProfessorInput(key, professorDetails[key], updatedErrors);\n\n    setProfessorErrors(_objectSpread({}, updatedErrors));\n\n    const fastProfessorErrors = _objectSpread({}, updatedErrors);\n\n    let ready = true;\n\n    for (var key in fastProfessorErrors) {\n      if (fastProfessorErrors.hasOwnProperty(key)) if (fastProfessorErrors[key] != \"\") ready = false;\n    }\n\n    console.log(\"Ready:\", ready);\n    console.log(professorDetails);\n\n    if (ready) {\n      writeToBlockChain().then(r => {\n        console.log(r);\n        const data = new FormData();\n        data.append(\"image\", professorDetails.file);\n        data.append(\"address\", professorDetails.address);\n        const config = {\n          headers: {\n            \"Content-type\": \"multipart/form-data\"\n          }\n        };\n        axios.post(uploadEndpoint, data, config).then(res => {\n          console.log(res);\n          props.onToastChange(\"UPLOAD SUCCESS: Picture uploaded\", \"success\", true);\n        }).catch(err => {\n          props.onToastChange(\"UPLOAD ERROR: Something went wrong or already uploaded with current account\", \"error\", true);\n          console.log(err);\n        });\n        props.onToastChange(\"TxN SUCCESS: You have been registered\", \"success\", true);\n        setTimeout(() => props.closeModal(), 3500);\n      }).catch(e => {\n        if (e.code == \"INVALID_ARGUMENT\") props.onToastChange(\"ERROR: Ticket should be in hex\", \"error\", true);else if (e.code == \"4001\") props.onToastChange(\"TxN WARN: Denied by user\", \"warning\", true);else if (e.code == \"-32603\") props.onToastChange(\"TxN ERROR: Invalid ticket\", \"error\", true);else props.onToastChange(\"TxN ERROR: Something went wrong\", \"error\", true);\n      }).finally(() => props.onLoading(false));\n    }\n  };\n\n  const convertBase64 = file => {\n    return new Promise((resolve, reject) => {\n      const fileReader = new FileReader();\n      fileReader.readAsDataURL(file);\n\n      fileReader.onload = () => {\n        resolve(fileReader.result);\n      };\n\n      fileReader.onerror = error => {\n        console.log(error);\n        reject(error);\n      };\n    });\n  };\n\n  const handleImageFileUpload = async e => {\n    switch (e.target.name) {\n      case \"pic\":\n        // const file = e.target.files[0];\n        // const base64 = await convertBase64(file)\n        // console.log(base64);\n        setDisableUpload({\n          message: \"Uploaded\",\n          disabled: true\n        });\n        setProfessorDetails(_objectSpread({}, professorDetails, {\n          file: e.target.files[0]\n        }));\n        break;\n\n      default:\n        props.onToastChange(\"ERROR: While uploading file\", \"error\", true);\n        console.error(\"Error while uploading file\");\n        break;\n    }\n  }; // Validators\n\n\n  const validateProfessorInput = (field, value, updatedErrors) => {\n    switch (field) {\n      case \"name\":\n        if (value.length == 0) updatedErrors[field] = \"Cannot be empty\";else if (value.length < 5) updatedErrors[field] = \"Length should be greater than 5\";else if (value.length > 30) updatedErrors[field] = \"Length should be smaller than 30\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"ticket\":\n      case \"address\":\n        if (value.length == 0) updatedErrors[field] = \"Cannot be empty\";else if (value.length < 10) updatedErrors[field] = \"Length should be greater than 10\";else if (value.length > 100) updatedErrors[field] = \"Length should be smaller than 100\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"email\":\n        var re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n        if (value.length == 0) updatedErrors[field] = \"Cannot be empty\";else if (!re.test(value)) updatedErrors[field] = \"Invalid email!\";else if (!(value.endsWith(\"@itbhu.ac.in\") || value.endsWith(\"@iitbhu.ac.in\"))) updatedErrors[field] = \"Invalid domain, accepted domains are @itbhu.ac.in or @iitbhu.ac.in\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"file\":\n        if (value.length == 0) updatedErrors[field] = \"\"; // Must upload display picture\n        else updatedErrors[field] = \"\";\n        break;\n    }\n\n    return updatedErrors;\n  };\n\n  return React.createElement(\"div\", {\n    className: \"cards\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233\n    },\n    __self: this\n  }, React.createElement(ProfessorDetailsFunctionBox, {\n    data: professorDetails,\n    errors: professorErrors,\n    handleInputChange: handleProfessorInputChange,\n    handleSubmit: handlerProfessorSubmit,\n    handleFileChange: handleImageFileUpload,\n    disableUpload: disableUpload,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234\n    },\n    __self: this\n  }));\n};\n\nexport default ProfessorDetails;","map":{"version":3,"sources":["F:/BlockChain/Projects/feedback-dapp-full/feedback-dapp/client/src/components/Modals/ProfessorDetails/professorDetails.js"],"names":["React","useState","axios","ProfessorDetailsFunctionBox","PYTHON_BASE_URL","ProfessorDetails","props","uploadEndpoint","address","account","ticket","name","email","file","professorDetails","setProfessorDetails","professorErrors","setProfessorErrors","message","disabled","disableUpload","setDisableUpload","writeToBlockChain","feedbackData","contracts","undefined","result","methods","createProfessor","send","from","console","log","onToastChange","handleProfessorInputChange","event","target","value","updatedErrors","validateProfessorInput","handlerProfessorSubmit","onLoading","key","hasOwnProperty","fastProfessorErrors","ready","then","r","data","FormData","append","config","headers","post","res","catch","err","setTimeout","closeModal","e","code","finally","convertBase64","Promise","resolve","reject","fileReader","FileReader","readAsDataURL","onload","onerror","error","handleImageFileUpload","files","field","length","re","test","endsWith"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport ProfessorDetailsFunctionBox from \"../../FunctionBox/ProfessorDetailsFunctionBox/professorDetailsFunctionBox\";\r\n\r\nimport \"./professorDetails.css\";\r\nimport { PYTHON_BASE_URL } from \"../../../constants\";\r\n\r\nconst ProfessorDetails = (props) => {\r\n  const uploadEndpoint = `${PYTHON_BASE_URL}upload`;\r\n\r\n  const [professorDetails, setProfessorDetails] = useState({\r\n    address: props.account,\r\n    ticket: \"\",\r\n    name: \"Dr. \",\r\n    email: \"\",\r\n    file: \"\",\r\n  });\r\n\r\n  const [professorErrors, setProfessorErrors] = useState({\r\n    address: \"\",\r\n    ticket: \"\",\r\n    name: \"\",\r\n    email: \"\",\r\n    file: \"\",\r\n  });\r\n\r\n  const [disableUpload, setDisableUpload] = useState({\r\n    message: \"\",\r\n    disabled: false,\r\n  });\r\n\r\n  // Asyncs:\r\n  const writeToBlockChain = async () => {\r\n    const feedbackData = props.contracts.feedbackData;\r\n    if (feedbackData != undefined) {\r\n      let result = await feedbackData.methods\r\n        .createProfessor(\r\n          professorDetails.name,\r\n          professorDetails.email,\r\n          \"\",\r\n          professorDetails.ticket\r\n        )\r\n        .send({ from: professorDetails.address });\r\n      console.log(result);\r\n      return result;\r\n    } else {\r\n      props.onToastChange(\r\n        \"INTERNAL-ERROR: Contract not deployed\",\r\n        \"error\",\r\n        true\r\n      );\r\n      console.log(\"Feedback contract not deployed\");\r\n    }\r\n  };\r\n\r\n  // Handlers\r\n  const handleProfessorInputChange = (event) => {\r\n    setProfessorDetails({\r\n      ...professorDetails,\r\n      [event.target.name]: event.target.value,\r\n    });\r\n\r\n    let updatedErrors = { ...professorErrors };\r\n    updatedErrors = validateProfessorInput(\r\n      event.target.name,\r\n      event.target.value,\r\n      updatedErrors\r\n    );\r\n    setProfessorErrors({ ...updatedErrors });\r\n  };\r\n\r\n  const handlerProfessorSubmit = () => {\r\n    props.onLoading(true);\r\n    let updatedErrors = { ...professorErrors };\r\n\r\n    for (var key in professorDetails)\r\n      if (professorDetails.hasOwnProperty(key))\r\n        updatedErrors = validateProfessorInput(\r\n          key,\r\n          professorDetails[key],\r\n          updatedErrors\r\n        );\r\n\r\n    setProfessorErrors({ ...updatedErrors });\r\n    const fastProfessorErrors = { ...updatedErrors };\r\n\r\n    let ready = true;\r\n    for (var key in fastProfessorErrors) {\r\n      if (fastProfessorErrors.hasOwnProperty(key))\r\n        if (fastProfessorErrors[key] != \"\") ready = false;\r\n    }\r\n\r\n    console.log(\"Ready:\", ready);\r\n    console.log(professorDetails);\r\n\r\n    if (ready) {\r\n      writeToBlockChain()\r\n        .then((r) => {\r\n          console.log(r);\r\n\r\n          const data = new FormData();\r\n          data.append(\"image\", professorDetails.file);\r\n          data.append(\"address\", professorDetails.address);\r\n          const config = {\r\n            headers: {\r\n              \"Content-type\": \"multipart/form-data\",\r\n            },\r\n          };\r\n          axios\r\n            .post(uploadEndpoint, data, config)\r\n            .then((res) => {\r\n              console.log(res);\r\n              props.onToastChange(\r\n                \"UPLOAD SUCCESS: Picture uploaded\",\r\n                \"success\",\r\n                true\r\n              );\r\n            })\r\n            .catch((err) => {\r\n              props.onToastChange(\r\n                \"UPLOAD ERROR: Something went wrong or already uploaded with current account\",\r\n                \"error\",\r\n                true\r\n              );\r\n              console.log(err);\r\n            });\r\n\r\n          props.onToastChange(\r\n            \"TxN SUCCESS: You have been registered\",\r\n            \"success\",\r\n            true\r\n          );\r\n          setTimeout(() => props.closeModal(), 3500);\r\n        })\r\n        .catch((e) => {\r\n          if (e.code == \"INVALID_ARGUMENT\")\r\n            props.onToastChange(\r\n              \"ERROR: Ticket should be in hex\",\r\n              \"error\",\r\n              true\r\n            );\r\n          else if (e.code == \"4001\")\r\n            props.onToastChange(\"TxN WARN: Denied by user\", \"warning\", true);\r\n          else if (e.code == \"-32603\")\r\n            props.onToastChange(\"TxN ERROR: Invalid ticket\", \"error\", true);\r\n          else\r\n            props.onToastChange(\r\n              \"TxN ERROR: Something went wrong\",\r\n              \"error\",\r\n              true\r\n            );\r\n        })\r\n        .finally(() => props.onLoading(false));\r\n    }\r\n  };\r\n\r\n  const convertBase64 = (file) => {\r\n    return new Promise((resolve, reject) => {\r\n      const fileReader = new FileReader();\r\n      fileReader.readAsDataURL(file);\r\n      fileReader.onload = () => {\r\n        resolve(fileReader.result);\r\n      };\r\n      fileReader.onerror = (error) => {\r\n        console.log(error);\r\n        reject(error);\r\n      };\r\n    });\r\n  };\r\n\r\n  const handleImageFileUpload = async (e) => {\r\n    switch (e.target.name) {\r\n      case \"pic\":\r\n        // const file = e.target.files[0];\r\n        // const base64 = await convertBase64(file)\r\n        // console.log(base64);\r\n        setDisableUpload({\r\n          message: \"Uploaded\",\r\n          disabled: true,\r\n        });\r\n        setProfessorDetails({ ...professorDetails, file: e.target.files[0] });\r\n\r\n        break;\r\n      default:\r\n        props.onToastChange(\"ERROR: While uploading file\", \"error\", true);\r\n        console.error(\"Error while uploading file\");\r\n        break;\r\n    }\r\n  };\r\n\r\n  // Validators\r\n  const validateProfessorInput = (field, value, updatedErrors) => {\r\n    switch (field) {\r\n      case \"name\":\r\n        if (value.length == 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (value.length < 5)\r\n          updatedErrors[field] = \"Length should be greater than 5\";\r\n        else if (value.length > 30)\r\n          updatedErrors[field] = \"Length should be smaller than 30\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"ticket\":\r\n      case \"address\":\r\n        if (value.length == 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (value.length < 10)\r\n          updatedErrors[field] = \"Length should be greater than 10\";\r\n        else if (value.length > 100)\r\n          updatedErrors[field] = \"Length should be smaller than 100\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"email\":\r\n        var re =\r\n          /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n        if (value.length == 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (!re.test(value)) updatedErrors[field] = \"Invalid email!\";\r\n        else if (\r\n          !(value.endsWith(\"@itbhu.ac.in\") || value.endsWith(\"@iitbhu.ac.in\"))\r\n        )\r\n          updatedErrors[field] =\r\n            \"Invalid domain, accepted domains are @itbhu.ac.in or @iitbhu.ac.in\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"file\":\r\n        if (value.length == 0)\r\n          updatedErrors[field] = \"\"; // Must upload display picture\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n    }\r\n    return updatedErrors;\r\n  };\r\n\r\n  return (\r\n    <div className=\"cards\">\r\n      <ProfessorDetailsFunctionBox\r\n        data={professorDetails}\r\n        errors={professorErrors}\r\n        handleInputChange={handleProfessorInputChange}\r\n        handleSubmit={handlerProfessorSubmit}\r\n        handleFileChange={handleImageFileUpload}\r\n        disableUpload={disableUpload}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfessorDetails;\r\n"]},"metadata":{},"sourceType":"module"}