{"ast":null,"code":"import _defineProperty from \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp-full\\\\feedback-dapp\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp-full\\\\feedback-dapp\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp-full\\\\feedback-dapp\\\\client\\\\src\\\\components\\\\Modals\\\\AddCourses\\\\addCourses.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from \"react\";\nimport AddCourseFunctionBox from \"../../FunctionBox/AddCoursesFunctionBox/addCoursesFunctionBox\";\n\nconst AddCourses = props => {\n  const _useState = useState({\n    email: props.emailMap[props.account],\n    year: \"\",\n    numCourses: \"\",\n    courses: [{\n      name: \"\",\n      code: \"\",\n      sem: \"\",\n      students: \"\"\n    }]\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        addCourseDetails = _useState2[0],\n        setAddCourseDetails = _useState2[1];\n\n  const _useState3 = useState({\n    email: \"\",\n    year: \"\",\n    numCourses: \"\",\n    courses: [{\n      name: \"\",\n      code: \"\",\n      sem: \"\",\n      students: \"\"\n    }]\n  }),\n        _useState4 = _slicedToArray(_useState3, 2),\n        addCourseErrors = _useState4[0],\n        setAddCourseErrors = _useState4[1];\n\n  useEffect(() => {\n    const course = {\n      name: \"\",\n      code: \"\",\n      sem: \"\",\n      students: \"\"\n    };\n    let updatedCourses = [];\n\n    for (var i = 0; i < addCourseDetails.numCourses; i++) updatedCourses.push(course);\n\n    setAddCourseDetails(_objectSpread({}, addCourseDetails, {\n      courses: updatedCourses\n    }));\n    let updatedCourseErrors = [];\n\n    for (var j = 0; j < addCourseDetails.numCourses; j++) updatedCourseErrors.push(course);\n\n    setAddCourseErrors(_objectSpread({}, addCourseErrors, {\n      courses: updatedCourseErrors\n    })); // eslint-disable-next-line\n  }, [addCourseDetails.numCourses]); // Validators\n\n  const validateAddCourseInput = (field, value, updatedErrors) => {\n    switch (field) {\n      case \"email\":\n        var re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";else if (!re.test(value)) updatedErrors[field] = \"Invalid email!\";else if (!(value.endsWith(\"@itbhu.ac.in\") || value.endsWith(\"@iitbhu.ac.in\"))) updatedErrors[field] = \"Invalid domain, accepted domains are @itbhu.ac.in or @iitbhu.ac.in\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"year\":\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";else if (!/^\\d+$/.test(value)) updatedErrors[field] = \"Year should be numerical\";else if (value.length !== 4) updatedErrors[field] = \"Length should be exacty 4\";else if (!(value > 2000)) updatedErrors[field] = \"Year should be greater than 2000\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"numCourses\":\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";else if (!/^\\d+$/.test(value)) updatedErrors[field] = \"Should be numerical\";else if (value === 0) updatedErrors[field] = \"Cannot be 0\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"name\":\n      case \"code\":\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";else if (value.length > 50) updatedErrors[field] = \"Length should be smaller than 50\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"sem\":\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";else if (!(value === 0 || value === 1)) updatedErrors[field] = \"Can only be Even or Odd\";else updatedErrors[field] = \"\";\n        break;\n\n      case \"students\":\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";else if (!/^\\d+$/.test(value)) updatedErrors[field] = \"Should be numerical\";else if (value.length > 3) updatedErrors[field] = \"Not more than three digits\";else updatedErrors[field] = \"\";\n        break;\n\n      default:\n        break;\n    }\n\n    return updatedErrors;\n  }; // Asyncs:\n\n\n  const writeToBlockChain = async () => {\n    const feedbackData = props.contracts.feedbackData;\n    const courses = addCourseDetails.courses;\n\n    if (feedbackData) {\n      for (var i = 0; i < courses.length; i++) {\n        const _courses$i = courses[i],\n              name = _courses$i.name,\n              code = _courses$i.code,\n              sem = _courses$i.sem,\n              students = _courses$i.students;\n        let result = await feedbackData.methods.addCourse(addCourseDetails.year, addCourseDetails.email, name, code, sem, students).send({\n          from: props.account\n        });\n        console.log(result);\n        if (result === undefined) props.onToastChange(\"INTERNAL-ERROR: No response for TxN[\".concat(i + 1, \", \").concat(code, \"]\"), \"error\", true);\n      }\n    } else {\n      props.onToastChange(\"INTERNAL-ERROR: Feedback contract not deployed\", \"error\", true);\n      console.log(\"Feedback contract not deployed\");\n    }\n  }; // Handlers\n\n\n  const handleAddCourseInputChange = event => {\n    setAddCourseDetails(_objectSpread({}, addCourseDetails, {\n      [event.target.name]: event.target.value\n    }));\n\n    let updatedErrors = _objectSpread({}, addCourseErrors);\n\n    updatedErrors = validateAddCourseInput(event.target.name, event.target.value, updatedErrors);\n    setAddCourseErrors(_objectSpread({}, updatedErrors));\n  };\n\n  const handleCourseChange = (event, index) => {\n    let updatedCourses = [...addCourseDetails.courses];\n\n    let updatedCourse = _objectSpread({}, updatedCourses[index]);\n\n    updatedCourse[event.target.name] = event.target.value;\n    updatedCourses[index] = updatedCourse;\n    setAddCourseDetails(_objectSpread({}, addCourseDetails, {\n      courses: updatedCourses\n    }));\n    let updatedErrorses = [...addCourseErrors.courses];\n\n    let updatedErrors = _objectSpread({}, updatedErrorses[index]);\n\n    updatedErrors = validateAddCourseInput(event.target.name, event.target.value, updatedErrors);\n    updatedErrorses[index] = updatedErrors;\n    setAddCourseErrors(_objectSpread({}, addCourseErrors, {\n      courses: updatedErrorses\n    }));\n  };\n\n  const handlerAddCourseSubmit = () => {\n    props.onLoading(true);\n\n    let updatedErrors = _objectSpread({}, addCourseErrors);\n\n    let updatedCourseErrorses = [...addCourseErrors.courses];\n\n    for (var key in addCourseDetails) {\n      if (addCourseDetails.hasOwnProperty(key)) {\n        if (!Array.isArray(addCourseDetails[key])) {\n          updatedErrors = validateAddCourseInput(key, addCourseDetails[key], updatedErrors);\n        } else {\n          for (var i = 0; i < addCourseDetails.courses.length; i++) {\n            for (var akey in addCourseDetails.courses[i]) {\n              if (addCourseDetails.courses[i].hasOwnProperty(akey)) {\n                let updatedCourseErrors = _objectSpread({}, updatedCourseErrorses[i]);\n\n                updatedCourseErrors = validateAddCourseInput(akey, addCourseDetails.courses[i][akey], updatedCourseErrors);\n                updatedCourseErrorses[i] = updatedCourseErrors;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    setAddCourseErrors(_objectSpread({}, updatedErrors, {\n      courses: updatedCourseErrorses\n    }));\n\n    const fastaddCourseErrors = _objectSpread({}, updatedErrors, {\n      courses: updatedCourseErrorses\n    });\n\n    let ready = true;\n\n    for (var fkey in fastaddCourseErrors) {\n      if (fastaddCourseErrors.hasOwnProperty(fkey)) {\n        if (!Array.isArray(fastaddCourseErrors[fkey])) {\n          if (fastaddCourseErrors[fkey] !== \"\") ready = false;\n        } else {\n          if (fastaddCourseErrors[fkey].length === 0) ready = false;\n\n          for (var j = 0; j < fastaddCourseErrors.courses.length; j++) for (var ffkey in fastaddCourseErrors.courses[j]) if (fastaddCourseErrors.courses[j].hasOwnProperty(ffkey)) if (fastaddCourseErrors.courses[j][ffkey] !== \"\") ready = false;\n        }\n      }\n    }\n\n    console.log(\"Ready:\", ready);\n    console.log(addCourseDetails);\n\n    if (ready) {\n      writeToBlockChain().then(r => {\n        console.log(r);\n        props.onLoading(false);\n        props.onToastChange(\"TxN SUCCESS: Course(s) have been added\", \"success\", true);\n        setTimeout(() => props.closeModal(), 3500);\n      }).catch(e => {\n        console.log(e);\n        if (e.code === \"INVALID_ARGUMENT\") props.onToastChange(\"ERROR: INVALID_ARGUMENT\", \"error\", true);else if (e.code === \"4001\") props.onToastChange(\"TxN WARN: Denied by user\", \"warning\", true);else props.onToastChange(\"TxN ERROR: Something went wrong\", \"error\", true);\n      }).finally(() => props.onLoading(false));\n    }\n  };\n\n  return React.createElement(\"div\", {\n    className: \"cards\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272\n    },\n    __self: this\n  }, React.createElement(AddCourseFunctionBox, {\n    data: addCourseDetails,\n    errors: addCourseErrors,\n    handleInputChange: handleAddCourseInputChange,\n    handleCourseChange: handleCourseChange,\n    handleSubmit: handlerAddCourseSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273\n    },\n    __self: this\n  }));\n};\n\nexport default AddCourses;","map":{"version":3,"sources":["F:/BlockChain/Projects/feedback-dapp-full/feedback-dapp/client/src/components/Modals/AddCourses/addCourses.js"],"names":["React","useState","useEffect","AddCourseFunctionBox","AddCourses","props","email","emailMap","account","year","numCourses","courses","name","code","sem","students","addCourseDetails","setAddCourseDetails","addCourseErrors","setAddCourseErrors","course","updatedCourses","i","push","updatedCourseErrors","j","validateAddCourseInput","field","value","updatedErrors","re","length","test","endsWith","writeToBlockChain","feedbackData","contracts","result","methods","addCourse","send","from","console","log","undefined","onToastChange","handleAddCourseInputChange","event","target","handleCourseChange","index","updatedCourse","updatedErrorses","handlerAddCourseSubmit","onLoading","updatedCourseErrorses","key","hasOwnProperty","Array","isArray","akey","fastaddCourseErrors","ready","fkey","ffkey","then","r","setTimeout","closeModal","catch","e","finally"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport AddCourseFunctionBox from \"../../FunctionBox/AddCoursesFunctionBox/addCoursesFunctionBox\";\r\n\r\nconst AddCourses = (props) => {\r\n  const [addCourseDetails, setAddCourseDetails] = useState({\r\n    email: props.emailMap[props.account],\r\n    year: \"\",\r\n    numCourses: \"\",\r\n    courses: [\r\n      {\r\n        name: \"\",\r\n        code: \"\",\r\n        sem: \"\",\r\n        students: \"\",\r\n      },\r\n    ],\r\n  });\r\n\r\n  const [addCourseErrors, setAddCourseErrors] = useState({\r\n    email: \"\",\r\n    year: \"\",\r\n    numCourses: \"\",\r\n    courses: [\r\n      {\r\n        name: \"\",\r\n        code: \"\",\r\n        sem: \"\",\r\n        students: \"\",\r\n      },\r\n    ],\r\n  });\r\n\r\n  useEffect(() => {\r\n    const course = { name: \"\", code: \"\", sem: \"\", students: \"\" };\r\n    let updatedCourses = [];\r\n    for (var i = 0; i < addCourseDetails.numCourses; i++)\r\n      updatedCourses.push(course);\r\n\r\n    setAddCourseDetails({\r\n      ...addCourseDetails,\r\n      courses: updatedCourses,\r\n    });\r\n\r\n    let updatedCourseErrors = [];\r\n    for (var j = 0; j < addCourseDetails.numCourses; j++)\r\n      updatedCourseErrors.push(course);\r\n\r\n    setAddCourseErrors({\r\n      ...addCourseErrors,\r\n      courses: updatedCourseErrors,\r\n    });\r\n    // eslint-disable-next-line\r\n  }, [addCourseDetails.numCourses]);\r\n\r\n  // Validators\r\n  const validateAddCourseInput = (field, value, updatedErrors) => {\r\n    switch (field) {\r\n      case \"email\":\r\n        var re =\r\n          /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (!re.test(value)) updatedErrors[field] = \"Invalid email!\";\r\n        else if (\r\n          !(value.endsWith(\"@itbhu.ac.in\") || value.endsWith(\"@iitbhu.ac.in\"))\r\n        )\r\n          updatedErrors[field] =\r\n            \"Invalid domain, accepted domains are @itbhu.ac.in or @iitbhu.ac.in\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"year\":\r\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (!/^\\d+$/.test(value))\r\n          updatedErrors[field] = \"Year should be numerical\";\r\n        else if (value.length !== 4)\r\n          updatedErrors[field] = \"Length should be exacty 4\";\r\n        else if (!(value > 2000))\r\n          updatedErrors[field] = \"Year should be greater than 2000\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"numCourses\":\r\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (!/^\\d+$/.test(value))\r\n          updatedErrors[field] = \"Should be numerical\";\r\n        else if (value === 0) updatedErrors[field] = \"Cannot be 0\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"name\":\r\n      case \"code\":\r\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (value.length > 50)\r\n          updatedErrors[field] = \"Length should be smaller than 50\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"sem\":\r\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (!(value === 0 || value === 1))\r\n          updatedErrors[field] = \"Can only be Even or Odd\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      case \"students\":\r\n        if (value.length === 0) updatedErrors[field] = \"Cannot be empty\";\r\n        else if (!/^\\d+$/.test(value))\r\n          updatedErrors[field] = \"Should be numerical\";\r\n        else if (value.length > 3)\r\n          updatedErrors[field] = \"Not more than three digits\";\r\n        else updatedErrors[field] = \"\";\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    return updatedErrors;\r\n  };\r\n\r\n  // Asyncs:\r\n  const writeToBlockChain = async () => {\r\n    const feedbackData = props.contracts.feedbackData;\r\n    const courses = addCourseDetails.courses;\r\n    if (feedbackData) {\r\n      for (var i = 0; i < courses.length; i++) {\r\n        const { name, code, sem, students } = courses[i];\r\n        let result = await feedbackData.methods\r\n          .addCourse(\r\n            addCourseDetails.year,\r\n            addCourseDetails.email,\r\n            name,\r\n            code,\r\n            sem,\r\n            students\r\n          )\r\n          .send({ from: props.account });\r\n\r\n        console.log(result);\r\n        if (result === undefined)\r\n          props.onToastChange(\r\n            `INTERNAL-ERROR: No response for TxN[${i + 1}, ${code}]`,\r\n            \"error\",\r\n            true\r\n          );\r\n      }\r\n    } else {\r\n      props.onToastChange(\r\n        \"INTERNAL-ERROR: Feedback contract not deployed\",\r\n        \"error\",\r\n        true\r\n      );\r\n      console.log(\"Feedback contract not deployed\");\r\n    }\r\n  };\r\n\r\n  // Handlers\r\n  const handleAddCourseInputChange = (event) => {\r\n    setAddCourseDetails({\r\n      ...addCourseDetails,\r\n      [event.target.name]: event.target.value,\r\n    });\r\n\r\n    let updatedErrors = { ...addCourseErrors };\r\n    updatedErrors = validateAddCourseInput(\r\n      event.target.name,\r\n      event.target.value,\r\n      updatedErrors\r\n    );\r\n    setAddCourseErrors({ ...updatedErrors });\r\n  };\r\n\r\n  const handleCourseChange = (event, index) => {\r\n    let updatedCourses = [...addCourseDetails.courses];\r\n    let updatedCourse = { ...updatedCourses[index] };\r\n    updatedCourse[event.target.name] = event.target.value;\r\n    updatedCourses[index] = updatedCourse;\r\n\r\n    setAddCourseDetails({\r\n      ...addCourseDetails,\r\n      courses: updatedCourses,\r\n    });\r\n\r\n    let updatedErrorses = [...addCourseErrors.courses];\r\n    let updatedErrors = { ...updatedErrorses[index] };\r\n    updatedErrors = validateAddCourseInput(\r\n      event.target.name,\r\n      event.target.value,\r\n      updatedErrors\r\n    );\r\n    updatedErrorses[index] = updatedErrors;\r\n    setAddCourseErrors({ ...addCourseErrors, courses: updatedErrorses });\r\n  };\r\n\r\n  const handlerAddCourseSubmit = () => {\r\n    props.onLoading(true);\r\n    let updatedErrors = { ...addCourseErrors };\r\n    let updatedCourseErrorses = [...addCourseErrors.courses];\r\n\r\n    for (var key in addCourseDetails) {\r\n      if (addCourseDetails.hasOwnProperty(key)) {\r\n        if (!Array.isArray(addCourseDetails[key])) {\r\n          updatedErrors = validateAddCourseInput(\r\n            key,\r\n            addCourseDetails[key],\r\n            updatedErrors\r\n          );\r\n        } else {\r\n          for (var i = 0; i < addCourseDetails.courses.length; i++) {\r\n            for (var akey in addCourseDetails.courses[i]) {\r\n              if (addCourseDetails.courses[i].hasOwnProperty(akey)) {\r\n                let updatedCourseErrors = { ...updatedCourseErrorses[i] };\r\n                updatedCourseErrors = validateAddCourseInput(\r\n                  akey,\r\n                  addCourseDetails.courses[i][akey],\r\n                  updatedCourseErrors\r\n                );\r\n                updatedCourseErrorses[i] = updatedCourseErrors;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    setAddCourseErrors({ ...updatedErrors, courses: updatedCourseErrorses });\r\n    const fastaddCourseErrors = {\r\n      ...updatedErrors,\r\n      courses: updatedCourseErrorses,\r\n    };\r\n\r\n    let ready = true;\r\n    for (var fkey in fastaddCourseErrors) {\r\n      if (fastaddCourseErrors.hasOwnProperty(fkey)) {\r\n        if (!Array.isArray(fastaddCourseErrors[fkey])) {\r\n          if (fastaddCourseErrors[fkey] !== \"\") ready = false;\r\n        } else {\r\n          if (fastaddCourseErrors[fkey].length === 0) ready = false;\r\n          for (var j = 0; j < fastaddCourseErrors.courses.length; j++)\r\n            for (var ffkey in fastaddCourseErrors.courses[j])\r\n              if (fastaddCourseErrors.courses[j].hasOwnProperty(ffkey))\r\n                if (fastaddCourseErrors.courses[j][ffkey] !== \"\") ready = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(\"Ready:\", ready);\r\n    console.log(addCourseDetails);\r\n\r\n    if (ready) {\r\n      writeToBlockChain()\r\n        .then((r) => {\r\n          console.log(r);\r\n          props.onLoading(false);\r\n          props.onToastChange(\r\n            \"TxN SUCCESS: Course(s) have been added\",\r\n            \"success\",\r\n            true\r\n          );\r\n          setTimeout(() => props.closeModal(), 3500);\r\n        })\r\n        .catch((e) => {\r\n          console.log(e);\r\n          if (e.code === \"INVALID_ARGUMENT\")\r\n            props.onToastChange(\"ERROR: INVALID_ARGUMENT\", \"error\", true);\r\n          else if (e.code === \"4001\")\r\n            props.onToastChange(\"TxN WARN: Denied by user\", \"warning\", true);\r\n          else\r\n            props.onToastChange(\r\n              \"TxN ERROR: Something went wrong\",\r\n              \"error\",\r\n              true\r\n            );\r\n        })\r\n        .finally(() => props.onLoading(false));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"cards\">\r\n      <AddCourseFunctionBox\r\n        data={addCourseDetails}\r\n        errors={addCourseErrors}\r\n        handleInputChange={handleAddCourseInputChange}\r\n        handleCourseChange={handleCourseChange}\r\n        handleSubmit={handlerAddCourseSubmit}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddCourses;\r\n"]},"metadata":{},"sourceType":"module"}