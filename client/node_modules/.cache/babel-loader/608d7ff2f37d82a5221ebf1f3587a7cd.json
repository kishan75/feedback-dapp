{"ast":null,"code":"import _defineProperty from \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp\\\\client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"F:\\\\BlockChain\\\\Projects\\\\feedback-dapp\\\\client\\\\src\\\\components\\\\Modals\\\\GenerateTickets\\\\generateTickets.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport GenerateTicketsFunctionBox from '../../FunctionBox/GenerateTicketsFunctionBox/generateTicketsFunctionBox';\nimport \"./generateTickets.css\";\n\nconst GenerateTickets = props => {\n  const _useState = useState({\n    name: '',\n    code: '',\n    year: '',\n    sem: '',\n    students: '',\n    emails: []\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        genTicketsDetails = _useState2[0],\n        setGenTicketsDetails = _useState2[1];\n\n  const _useState3 = useState({\n    name: '',\n    code: '',\n    year: '',\n    sem: '',\n    students: '',\n    emails: ''\n  }),\n        _useState4 = _slicedToArray(_useState3, 2),\n        genTicketsErrors = _useState4[0],\n        setGenTicketsErrors = _useState4[1];\n\n  const _useState5 = useState(),\n        _useState6 = _slicedToArray(_useState5, 2),\n        courseDatas = _useState6[0],\n        setCourseDatas = _useState6[1];\n\n  const _useState7 = useState([]),\n        _useState8 = _slicedToArray(_useState7, 2),\n        courseNameOptions = _useState8[0],\n        setCourseNameOptions = _useState8[1];\n\n  const _useState9 = useState({\n    code: [],\n    year: [],\n    sem: [],\n    students: []\n  }),\n        _useState10 = _slicedToArray(_useState9, 2),\n        courseDataOptions = _useState10[0],\n        setCourseDataOptions = _useState10[1]; // React useEffect\n  // Get professor's course data from blockchain\n\n\n  useEffect(() => {\n    let courseDatas = [{\n      name: 'NetSec',\n      code: 'CSE-69',\n      year: '2021',\n      students: '20'\n    }, {\n      name: 'NetSec2',\n      code: 'CSE-692',\n      year: '2022',\n      students: '25'\n    }];\n    setCourseDatas(courseDatas);\n    let courseNameOptions = [];\n\n    for (var i = 0; i < courseDatas.length; i++) courseNameOptions.push(courseDatas[i].name);\n\n    setCourseNameOptions(courseNameOptions);\n  }, []); // Handlers\n\n  const handleCourseNameChanged = event => {\n    let updatedCourseCodeOptions = {\n      code: [],\n      year: [],\n      sem: [],\n      students: []\n    };\n    updatedCourseCodeOptions.sem = ['Even', 'Odd'];\n\n    for (var i = 0; i < courseDatas.length; i++) {\n      if (courseDatas[i].name == event.target.value) {\n        updatedCourseCodeOptions.code.push(courseDatas[i].code);\n        updatedCourseCodeOptions.year.push(courseDatas[i].year);\n        updatedCourseCodeOptions.students.push(courseDatas[i].students);\n      }\n    }\n\n    setCourseDataOptions(updatedCourseCodeOptions);\n  };\n\n  const handleGenTicketsInputChange = event => {\n    setGenTicketsDetails(_objectSpread({}, genTicketsDetails, {\n      [event.target.name]: event.target.value\n    }));\n\n    let updatedErrors = _objectSpread({}, genTicketsErrors);\n\n    updatedErrors = validateGenTicketsInput(event.target.name, event.target.value, updatedErrors);\n    setGenTicketsErrors(_objectSpread({}, updatedErrors));\n  };\n\n  const handleGenTicketsSubmit = () => {\n    let updatedErrors = _objectSpread({}, genTicketsErrors);\n\n    for (var key in genTicketsDetails) if (genTicketsDetails.hasOwnProperty(key)) updatedErrors = validateGenTicketsInput(key, genTicketsDetails[key], updatedErrors);\n\n    setGenTicketsErrors(_objectSpread({}, updatedErrors));\n\n    const fastGenTicketsErrors = _objectSpread({}, updatedErrors);\n\n    let ready = true;\n\n    for (var key in fastGenTicketsErrors) if (fastGenTicketsErrors.hasOwnProperty(key)) if (fastGenTicketsErrors[key] != '') ready = false;\n\n    console.log('Ready:', ready); // All validation tests passed\n\n    console.log(genTicketsDetails);\n    console.log(fastGenTicketsErrors); // Send Email\n\n    if (ready) {\n      const mail = {\n        Host: \"smtp.elasticemail.com\",\n        Port: 2525,\n        Username: \"feedback.dapp@gmail.com\",\n        Password: \"812195DD647B3B77757DA600C55529F34E3E\",\n        To: ['binit.57.singh@gmail.com'],\n        //genTicketsDetails.emails\n        From: \"feedback.dapp@gmail.com\",\n        Subject: \"Feedback Request\",\n        Body: \"<b>Hello </b>there, <br><br>You are requested to sumbit a feedback for:<br>\" + \"<b>Course: </b>\" + genTicketsDetails.name + \"<br>\" + \"<b>Code: </b>\" + genTicketsDetails.code + \"<br>\" + \"<b>Year: </b>\" + genTicketsDetails.year + \"<br>\" + \"<b>Semester: </b>\" + genTicketsDetails.sem + \"<br>\" + \"<b>Professor: </b>\" + \"props.professorName\" + \"<br><br>\" + \"Please use this unique ticket: <b>YYXXZZ</b> to submit the feedack anonymously<br><br>\" + \"Best wishes,<br>\" + \"Feedback-DApp team\"\n      };\n      console.log(mail);\n      window.Email.send(mail).then(function (message) {\n        if (message == 'OK') console.log('Email Sent', message);else console.log('Email Fail', message);\n      }).catch(function (message) {\n        console.log('Email Fail', message);\n      });\n    }\n  };\n\n  const handleEmailFileUpload = e => {\n    switch (e.target.name) {\n      case 'emailsfile':\n        const file = e.target.files[0];\n        const reader = new FileReader();\n        let emails = [];\n\n        reader.onload = function (e) {\n          let text = e.target.result;\n          text = text.split(/,| |\\n|\\r/);\n          console.log(text);\n\n          for (var i = 0; i < text.length; i++) if (text[i].endsWith('@itbhu.ac.in') || text[i].endsWith('@iitbhu.ac.in') && re.test(text[i])) emails.push(text[i]);\n\n          console.log(emails);\n          setGenTicketsDetails(_objectSpread({}, genTicketsDetails, {\n            emails: emails\n          }));\n        };\n\n        reader.readAsText(file);\n        break;\n\n      default:\n        console.error('Error while uploading file');\n        break;\n    }\n  }; // Validators\n\n\n  const validateGenTicketsInput = (field, value, updatedErrors) => {\n    switch (field) {\n      case 'name':\n      case 'code':\n        if (value.length == 0) updatedErrors[field] = 'Cannot be empty';else if (value.length > 50) updatedErrors[field] = 'Length should be smaller than 50';else updatedErrors[field] = '';\n        break;\n\n      case 'emails':\n        if (value.length == 0) updatedErrors[field] = 'Please upload a csv file with student emails';else if (value.length != genTicketsDetails.students) updatedErrors[field] = \"Number of uploaded emails(\".concat(value.length, \") should be equal to students(\").concat(genTicketsDetails.students, \")\");else updatedErrors[field] = '';\n        break;\n\n      case 'year':\n        if (value.length == 0) updatedErrors[field] = 'Cannot be empty';else if (!/^\\d+$/.test(value)) updatedErrors[field] = 'Year should be numerical';else if (value.length != 4) updatedErrors[field] = 'Length should be exacty 4';else if (!(value > 2000)) updatedErrors[field] = 'Year should be greater than 2000';else updatedErrors[field] = '';\n        break;\n\n      case 'sem':\n        if (value.length == 0) updatedErrors[field] = 'Cannot be empty';else if (!(value == 'Even' || value == 'Odd')) updatedErrors[field] = 'Can only be Even or Odd';else updatedErrors[field] = '';\n        break;\n\n      case 'students':\n        if (value.length == 0) updatedErrors[field] = 'Cannot be empty';else if (!/^\\d+$/.test(value)) updatedErrors[field] = 'Should be numerical';else updatedErrors[field] = '';\n        break;\n    }\n\n    return updatedErrors;\n  };\n\n  return React.createElement(\"div\", {\n    className: \"cards\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235\n    },\n    __self: this\n  }, React.createElement(GenerateTicketsFunctionBox, {\n    data: genTicketsDetails,\n    errors: genTicketsErrors,\n    mainOptions: courseNameOptions,\n    subOptions: courseDataOptions,\n    handleMainChange: handleCourseNameChanged,\n    handleInputChange: handleGenTicketsInputChange,\n    handleFileChange: handleEmailFileUpload,\n    handleSubmit: handleGenTicketsSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236\n    },\n    __self: this\n  }));\n};\n\nexport default GenerateTickets;\nconst re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;","map":{"version":3,"sources":["F:/BlockChain/Projects/feedback-dapp/client/src/components/Modals/GenerateTickets/generateTickets.js"],"names":["React","useState","useEffect","GenerateTicketsFunctionBox","GenerateTickets","props","name","code","year","sem","students","emails","genTicketsDetails","setGenTicketsDetails","genTicketsErrors","setGenTicketsErrors","courseDatas","setCourseDatas","courseNameOptions","setCourseNameOptions","courseDataOptions","setCourseDataOptions","i","length","push","handleCourseNameChanged","event","updatedCourseCodeOptions","target","value","handleGenTicketsInputChange","updatedErrors","validateGenTicketsInput","handleGenTicketsSubmit","key","hasOwnProperty","fastGenTicketsErrors","ready","console","log","mail","Host","Port","Username","Password","To","From","Subject","Body","window","Email","send","then","message","catch","handleEmailFileUpload","e","file","files","reader","FileReader","onload","text","result","split","endsWith","re","test","readAsText","error","field"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport GenerateTicketsFunctionBox from '../../FunctionBox/GenerateTicketsFunctionBox/generateTicketsFunctionBox';\r\n\r\nimport \"./generateTickets.css\";\r\n\r\n\r\nconst GenerateTickets = (props) => {\r\n    const [genTicketsDetails, setGenTicketsDetails] = useState({\r\n        name: '',\r\n        code: '',\r\n        year: '',\r\n        sem: '',\r\n        students: '',\r\n        emails: []\r\n    });\r\n\r\n    const [genTicketsErrors, setGenTicketsErrors] = useState({\r\n        name: '',\r\n        code: '',\r\n        year: '',\r\n        sem: '',\r\n        students: '',\r\n        emails: ''\r\n    })\r\n\r\n    const [courseDatas, setCourseDatas] = useState();\r\n    const [courseNameOptions, setCourseNameOptions] = useState([]);\r\n    const [courseDataOptions, setCourseDataOptions] = useState({\r\n        code: [],\r\n        year: [],\r\n        sem: [],\r\n        students: []\r\n    });\r\n\r\n\r\n    // React useEffect\r\n    // Get professor's course data from blockchain\r\n    useEffect(() => {\r\n        let courseDatas = [{\r\n            name: 'NetSec',\r\n            code: 'CSE-69',\r\n            year: '2021',\r\n            students: '20',\r\n        },\r\n        {\r\n            name: 'NetSec2',\r\n            code: 'CSE-692',\r\n            year: '2022',\r\n            students: '25',\r\n        }]\r\n\r\n        setCourseDatas(courseDatas);\r\n\r\n        let courseNameOptions = []\r\n        for (var i = 0; i < courseDatas.length; i++)\r\n            courseNameOptions.push(courseDatas[i].name);\r\n\r\n        setCourseNameOptions(courseNameOptions);\r\n    }, []);\r\n\r\n\r\n\r\n    // Handlers\r\n    const handleCourseNameChanged = (event) => {\r\n        let updatedCourseCodeOptions = {\r\n            code: [],\r\n            year: [],\r\n            sem: [],\r\n            students: []\r\n        }\r\n\r\n        updatedCourseCodeOptions.sem = ['Even', 'Odd']\r\n        for (var i = 0; i < courseDatas.length; i++) {\r\n            if (courseDatas[i].name == event.target.value) {\r\n                updatedCourseCodeOptions.code.push(courseDatas[i].code);\r\n                updatedCourseCodeOptions.year.push(courseDatas[i].year);\r\n                updatedCourseCodeOptions.students.push(courseDatas[i].students);\r\n            }\r\n        }\r\n        setCourseDataOptions(updatedCourseCodeOptions);\r\n    }\r\n\r\n    const handleGenTicketsInputChange = (event) => {\r\n\r\n        setGenTicketsDetails({\r\n            ...genTicketsDetails,\r\n            [event.target.name]: event.target.value\r\n        });\r\n\r\n        let updatedErrors = { ...genTicketsErrors };\r\n        updatedErrors = validateGenTicketsInput(event.target.name, event.target.value, updatedErrors);\r\n        setGenTicketsErrors({ ...updatedErrors });\r\n    };\r\n\r\n\r\n    const handleGenTicketsSubmit = () => {\r\n        let updatedErrors = { ...genTicketsErrors };\r\n\r\n        for (var key in genTicketsDetails)\r\n            if (genTicketsDetails.hasOwnProperty(key))\r\n                updatedErrors = validateGenTicketsInput(key, genTicketsDetails[key], updatedErrors);\r\n\r\n        setGenTicketsErrors({ ...updatedErrors });\r\n        const fastGenTicketsErrors = { ...updatedErrors };\r\n\r\n        let ready = true;\r\n        for (var key in fastGenTicketsErrors)\r\n            if (fastGenTicketsErrors.hasOwnProperty(key))\r\n                if (fastGenTicketsErrors[key] != '')\r\n                    ready = false;\r\n\r\n        console.log('Ready:', ready);  // All validation tests passed\r\n        console.log(genTicketsDetails);\r\n        console.log(fastGenTicketsErrors);\r\n\r\n        // Send Email\r\n        if (ready) {\r\n            const mail = {\r\n                Host: \"smtp.elasticemail.com\",\r\n                Port: 2525,\r\n                Username: \"feedback.dapp@gmail.com\",\r\n                Password: \"812195DD647B3B77757DA600C55529F34E3E\",\r\n                To: ['binit.57.singh@gmail.com'], //genTicketsDetails.emails\r\n                From: \"feedback.dapp@gmail.com\",\r\n                Subject: \"Feedback Request\",\r\n                Body: \"<b>Hello </b>there, <br><br>You are requested to sumbit a feedback for:<br>\" +\r\n                    \"<b>Course: </b>\" + genTicketsDetails.name + \"<br>\" +\r\n                    \"<b>Code: </b>\" + genTicketsDetails.code + \"<br>\" +\r\n                    \"<b>Year: </b>\" + genTicketsDetails.year + \"<br>\" +\r\n                    \"<b>Semester: </b>\" + genTicketsDetails.sem + \"<br>\" +\r\n                    \"<b>Professor: </b>\" + \"props.professorName\" + \"<br><br>\" +\r\n                    \"Please use this unique ticket: <b>YYXXZZ</b> to submit the feedack anonymously<br><br>\" +\r\n                    \"Best wishes,<br>\" +\r\n                    \"Feedback-DApp team\",\r\n            };\r\n\r\n            console.log(mail);\r\n            window.Email.send(mail)\r\n                .then(function (message) {\r\n                    if (message == 'OK')\r\n                        console.log('Email Sent', message)\r\n                    else\r\n                        console.log('Email Fail', message);\r\n                })\r\n                .catch(function (message) {\r\n                    console.log('Email Fail', message)\r\n                })\r\n        }\r\n    }\r\n\r\n\r\n    const handleEmailFileUpload = (e) => {\r\n        switch (e.target.name) {\r\n            case 'emailsfile':\r\n                const file = e.target.files[0];\r\n                const reader = new FileReader();\r\n                let emails = []\r\n                reader.onload = function (e) {\r\n                    let text = e.target.result;\r\n                    text = text.split(/,| |\\n|\\r/);\r\n                    console.log(text);\r\n\r\n                    for (var i = 0; i < text.length; i++)\r\n                        if (text[i].endsWith('@itbhu.ac.in') || text[i].endsWith('@iitbhu.ac.in') && re.test(text[i]))\r\n                            emails.push(text[i]);\r\n\r\n                    console.log(emails);\r\n                    setGenTicketsDetails({ ...genTicketsDetails, emails: emails });\r\n                }\r\n\r\n                reader.readAsText(file);\r\n\r\n                break;\r\n            default:\r\n                console.error('Error while uploading file'); break;\r\n        }\r\n    }\r\n\r\n\r\n    // Validators\r\n    const validateGenTicketsInput = (field, value, updatedErrors) => {\r\n        switch (field) {\r\n            case 'name':\r\n            case 'code':\r\n                if (value.length == 0)\r\n                    updatedErrors[field] = 'Cannot be empty';\r\n                else if (value.length > 50)\r\n                    updatedErrors[field] = 'Length should be smaller than 50';\r\n                else\r\n                    updatedErrors[field] = ''\r\n                break;\r\n            case 'emails':\r\n                if (value.length == 0)\r\n                    updatedErrors[field] = 'Please upload a csv file with student emails';\r\n                else if (value.length != genTicketsDetails.students)\r\n                    updatedErrors[field] = `Number of uploaded emails(${value.length}) should be equal to students(${genTicketsDetails.students})`;\r\n                else\r\n                    updatedErrors[field] = ''\r\n                break;\r\n            case 'year':\r\n                if (value.length == 0)\r\n                    updatedErrors[field] = 'Cannot be empty';\r\n                else if (!/^\\d+$/.test(value))\r\n                    updatedErrors[field] = 'Year should be numerical';\r\n                else if (value.length != 4)\r\n                    updatedErrors[field] = 'Length should be exacty 4';\r\n                else if (!(value > 2000))\r\n                    updatedErrors[field] = 'Year should be greater than 2000';\r\n                else\r\n                    updatedErrors[field] = ''\r\n                break;\r\n            case 'sem':\r\n                if (value.length == 0)\r\n                    updatedErrors[field] = 'Cannot be empty';\r\n                else if (!(value == 'Even' || value == 'Odd'))\r\n                    updatedErrors[field] = 'Can only be Even or Odd';\r\n                else\r\n                    updatedErrors[field] = ''\r\n                break;\r\n            case 'students':\r\n                if (value.length == 0)\r\n                    updatedErrors[field] = 'Cannot be empty';\r\n                else if (!/^\\d+$/.test(value))\r\n                    updatedErrors[field] = 'Should be numerical';\r\n                else\r\n                    updatedErrors[field] = ''\r\n                break;\r\n\r\n        }\r\n        return updatedErrors;\r\n    }\r\n\r\n\r\n    return (\r\n        <div className='cards'>\r\n            <GenerateTicketsFunctionBox\r\n                data={genTicketsDetails}\r\n                errors={genTicketsErrors}\r\n                mainOptions={courseNameOptions}\r\n                subOptions={courseDataOptions}\r\n                handleMainChange={handleCourseNameChanged}\r\n                handleInputChange={handleGenTicketsInputChange}\r\n                handleFileChange={handleEmailFileUpload}\r\n                handleSubmit={handleGenTicketsSubmit}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GenerateTickets;\r\n\r\n\r\n\r\nconst re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;"]},"metadata":{},"sourceType":"module"}